<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Intro to PopupTemplate - 4.14</title>
  </head>
  
    <style>
    
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      
   
      
    </style>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.14/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.14/"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script>
      require([
        "esri/Map",
        "esri/layers/FeatureLayer",
        "esri/views/MapView",
        "esri/widgets/Legend",
        "esri/layers/VectorTileLayer",
        "esri/layers/TileLayer",
      ], function(Map, FeatureLayer, MapView, Legend, VectorTileLayer, TileLayer) {
      
        // Create the map
        var map = new Map({
          basemap: "dark-gray"
        });

        // Create the MapView
        var view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-73.95, 40.702],
          zoom: 11
        });



        var template = {
          // autocasts as new PopupTemplate()
          title: "Tract {Final_Elig} in <br>{Final_El_4}</br>",
          content: [
            {
              // It is also possible to set the fieldInfos outside of the content
              // directly in the popupTemplate. If no fieldInfos is specifically set
              // in the content, it defaults to whatever may be set within the popupTemplate.
              type: "fields",
              fieldInfos: [
                {
                  fieldName: "Final_El_1",
                  label: "Eligible Locations:"
                },
                {
                  fieldName: "Final_El_2",
                  label: "Reserve ($):",
                  format: {
                    digitSeparator: true,
                    places: 2
                  }
                },
                {
                  fieldName: "2010Trac_8",
                  label: "Tract Population:"
                },
                
              ]
            }
          ]
        };
        
        

        
        
    $("#elig_support_legend").hide();
    $("#elig_locs_legend").hide();
    $("#split_blocks_legend_low").hide();
    $("#split_blocks_legend_high").hide();
        
        
        

        
        
        

        // Reference the popupTemplate instance in the
        // popupTemplate property of FeatureLayer
        var featureLayer = new FeatureLayer({url:"https://services.arcgis.com/YnOQrIGdN9JGtBh4/arcgis/rest/services/Final_Eligible_Tracts/FeatureServer",
          popupTemplate: template
        });
        
        var elig_locs_no_border = new VectorTileLayer({ url: 'https://tiles.arcgis.com/tiles/YnOQrIGdN9JGtBh4/arcgis/rest/services/Eligible_Locations_Tract/VectorTileServer',
        visible: false})
        var elig_support_no_border = new VectorTileLayer({ url: 'https://tiles.arcgis.com/tiles/YnOQrIGdN9JGtBh4/arcgis/rest/services/Eligible_Tracts_Support/VectorTileServer',
        visible: false}) 
        var area_no_border = new VectorTileLayer({ url: 'https://tiles.arcgis.com/tiles/YnOQrIGdN9JGtBh4/arcgis/rest/services/Eligible_Coverage_Area/VectorTileServer'}) 

        
        
        map.add(featureLayer);               
        map.add(elig_locs_no_border)                 
        map.add(elig_support_no_border)
        map.add(area_no_border)
        //map.add(split_blocks) 
        
        
     
        
      document.getElementById("elig_area_legend").style.visibility = 'visible';
      
   // Create event listener and button actionws for eligible area layer and legend
      var split_blocks_toggle = document.getElementById("C1");
      var elig_area_toggle = document.getElementById("B1");
      elig_area_toggle.checked = true;
      elig_area_toggle.addEventListener("change", function() {
      document.getElementById("elig_area_legend").style.visibility = 'visible';
      console.log('You are viewing eligible areas.')
      elig_locs_no_border.visible = false;
      elig_support_no_border.visible = false;
      area_no_border.visible = elig_area_toggle.checked;
      $("#elig_area_legend").fadeIn("fast");
      $("#elig_locs_legend").fadeOut("fast");
      $("#elig_support_legend").fadeOut("fast");
      if (elig_area_toggle.checked == true && split_blocks_toggle.checked == true){
      $("#split_blocks_legend_high").fadeOut("fast");
      $("#split_blocks_legend_low").fadeIn("fast");
      };
  });
        

       
        
   // Create event listener and button actionws for eligible locations layer and legend
      var elig_locs_toggle = document.getElementById("B2");
      document.getElementById("elig_locs_legend").style.visibility = 'visible';
      elig_locs_toggle.addEventListener("change", function() {
      console.log('You are viewing eligible locations.')
      elig_locs_no_border.visible = elig_locs_toggle.checked;
      area_no_border.visible = false;
      elig_support_no_border.visible = false;
      $("#elig_area_legend").fadeOut("fast");
      $("#elig_support_legend").fadeOut("fast");
      $("#elig_locs_legend").fadeIn("fast");
      if (elig_locs_toggle.checked == true && split_blocks_toggle.checked == true){
      $("#split_blocks_legend_high").fadeIn("fast");
      $("#split_blocks_legend_low").fadeOut("fast");
      };
  });  
        
        
    // Create event listener and button actionws for eligible suport layer and legend
      var elig_support_toggle = document.getElementById("B3");
      document.getElementById("elig_support_legend").style.visibility = 'visible';
      elig_support_toggle.addEventListener("change", function() {
      console.log('You are viewing annual suppport.')
      elig_support_no_border.visible = elig_support_toggle.checked;
      area_no_border.visible = false;
      elig_locs_no_border.visible = false;
      $("#elig_area_legend").fadeOut("fast");
      $("#elig_locs_legend").fadeOut("fast");
      $("#elig_support_legend").fadeIn("fast");
      if (elig_support_toggle.checked == true && split_blocks_toggle.checked == true){
      $("#split_blocks_legend_high").fadeIn("fast");
      $("#split_blocks_legend_low").fadeOut("fast");
      }
  }); 
        
    
        
        
        view.on("click", function(event){
        var query = featureLayer.createQuery();
        query.returnGeometry = true;
        query.outFields = ["*"];
        query.geometry = event.mapPoint;
        featureLayer.queryFeatures(query).then(function (resp) {
        console.log(resp);
        });
});
        
        
        
        
        
        
        
        
        
        
        
      });
    </script>
    
    
    
    


  <body>
    <div id="viewDiv"></div>


        <div id="btn-openLayerCtrl" class="esri-ui-corner">
            <div class="icon-layers esri-component esri-widget-button esri-widget"></div>
        </div>        

        
         <div id="helptext"><strong>&nbsp Select a Rural Digital Opportunity Fund Measure </strong>
         <br><input type="radio" id="B1" name="Button" value="B1"> <label for="B3">Coverage Area</label>
         <br><input type="radio" id="B2" name="Button" value="B2"> <label for="B2">Eligible Locations</label>
         <br><input type="radio" id="B3" name="Button" value="B3"> <label for="B4">Annual Support</label>
         </div>
         
         <div id="splitblocks">
         <input type="checkbox" id="C1" name="Checkbox" value="C1"> <label for="C1"> Show Slipt Blocks </label>
         </div>
         
        
       
        
        <div class="map-legend" id='elig_area_legend'>
            <table>
                <thead>
                    <tr>
                        <td colspan="3"><span class="icon icon-list"></span> <span class="map-legend-name"> Coverage Area Legend</span>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Eligible Area</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#BDD7E7 "></div>
                        </td>
                </tbody>
            </table>
        </div>
        
        
        
        
                <div class="map-legend" id='elig_locs_legend'>
            <table>
                <thead>
                    <tr>
                        <td colspan="3"><span class="icon icon-list"></span> <span class="map-legend-name"> Eligible Locaions Legend</span>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#EDF8FB"></div>
                        </td>
                        <td>0 - 200</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#B2E2E2"></div>
                        </td>
                        <td>200 - 600</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#56B990"></div>
                        </td>
                        <td>601 - 1000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#2CA25F"></div>
                        </td>
                        <td>1001 - 2000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#2CA25F"></div>
                        </td>
                        <td>2001 - 5000</td>
                    </tr>
            </table>
        </div>
        

                   <div class="map-legend" id='elig_support_legend'>
            <table>
                <thead>
                    <tr>
                        <td colspan="3"><span class="icon icon-list"></span> <span class="map-legend-name"> Annual Support Legend</span>

                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                         <td>
                            <div class="key-symbol" style="background-color:#F7FBFF"></div>
                        </td>
                        <td>0 - $130,000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#C6DBEF "></div>
                        </td>
                        <td>$130,001 - $400,000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#6BAED6"></div>
                        </td>
                        <td>$400,001 - $800,000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#2171B5 "></div>
                        </td>
                        <td>$800,001 - $1,600,000</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol" style="background-color:#08306B "></div>
                        </td>
                        <td>$1,600,000 - $4,600,000</td>
                    </tr>
            </table>
        </div>     
        
        
        <div class="map-legend" id='split_blocks_legend_high' style="bottom: 200px">
            <table>
                <thead>
                    <tr>
                        <td colspan="3"><span class="icon icon-list"></span> <span class="map-legend-name">Split Blocks Legend</span>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="key-symbol-line" style="border: solid 1px #FF0000"></div>
                        </td>
                        <td>Rate of Return</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol-line" style="border: solid 1px #00FFC5"></div>
                        </td>
                        <td>Tribal</td>
                    </tr>
                    <tr>
                    </tr>
            </table>
        </div> 
        
        
                <div class="map-legend" id='split_blocks_legend_low' style="bottom: 110px">
            <table>
                <thead>
                    <tr>
                        <td colspan="3"><span class="icon icon-list"></span> <span class="map-legend-name">Split Blocks Legend</span>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="key-symbol-line" style="border: solid 1px #FF0000"></div>
                        </td>
                        <td>Rate of Return</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="key-symbol-line" style="border: solid 1px #00FFC5"></div>
                        </td>
                        <td>Tribal</td>
                    </tr>
                    <tr>
                    </tr>
            </table>
        </div> 
        
        
        
        
        
        
        
        
        <button id="btn-openLegend" class="btn legend__icon" title="Map Legend"><span class="icon icon-list"></span></button>

  

